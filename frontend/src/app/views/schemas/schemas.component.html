<div class="content">
    <div class="page-title">Schemas</div>

    <div class="actions">



        <div class="tabs-nav">
            <p-tabView>
                <p-tabPanel *ngFor="let tab of schemasTypes" [selected]="tab.value === type">
                    <ng-template pTemplate="header">
                        <div (click)="onChangeType(tab.value)" class="tabview-label">{{ tab.label }}</div>
                    </ng-template>
                </p-tabPanel>
            </p-tabView>
        </div>

        <div class="actions-controls-container">
            <div class="policy-dropdown-container">
                <ng-container *ngIf="isPolicy">
                    <p-dropdown 
                        (onChange)="onFilter($event)" 
                        [(ngModel)]="currentTopic" 
                        [options]="policies"
                        [showClear]="true" 
                        class="policy-dropdown" 
                        optionLabel="name" 
                        optionValue="topicId"
                        placeholder="Policy"></p-dropdown>
                </ng-container>
                <ng-container *ngIf="isTool">
                    <p-dropdown 
                        (onChange)="onFilter($event)" 
                        [(ngModel)]="currentTopic" 
                        [options]="tools"
                        [showClear]="true" 
                        class="policy-dropdown" 
                        optionLabel="name" 
                        optionValue="topicId"
                        placeholder="Tool"></p-dropdown>
                </ng-container>
            </div>
            <div class="schema-actions-buttons-container">
                <p-button 
                    (click)="onCreateSchemas()" 
                    *ngIf="canCreate" 
                    class="toolbar-btn"
                >
                    <mat-icon class="toolbar-icons">add</mat-icon>
                    <span>Create a Schema</span>
                </p-button>
                <p-button 
                    (click)="onImportSchemas()" 
                    *ngIf="canImport" 
                    class="toolbar-btn"
                >
                    <mat-icon class="toolbar-icons">file_open</mat-icon>
                    <span>Import</span>
                </p-button>
                <p-button 
                    (click)="onCompare()" 
                    *ngIf="isPolicy || isModule || isTool"
                    class="toolbar-btn compare-button" 
                    styleClass="p-button-outlined"
                >
                    <mat-icon class="toolbar-icons">compare</mat-icon>
                    <span>Compare</span>
                </p-button>
            </div>
        </div>
    </div>

    <div *ngIf="isAny" class="table-container">
        <p-table [value]="page">

            <ng-template pTemplate="header">
                <tr>
                    <ng-container *ngIf="type === 'policy'">
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Policy
                        </th>
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Name
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Topic
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Version
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Entity
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Tags
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Status
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Operations
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'module'">
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Name
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Status
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Operations
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'tool'">
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Tool
                        </th>
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Name
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Status
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Operations
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'system'">
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Name
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Owner
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Entity
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Status
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Operations
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'tag'">
                        <th class="header-cell-text" style="min-width: 140px; max-width: 150px;">
                            Name
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Owner
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Status
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                            Operations
                        </th>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                </tr>
            </ng-template>

            <ng-template let-schema pTemplate="body">
                <tr class="schemas-grid-row">


                    <ng-container *ngIf="type === 'policy'">
                        <td class="first-schema-grid-cell text-truncate" style="min-width: 140px; max-width: 150px;">
                            <a [queryParams]="{
                                policyId: policyIdByTopic[schema.topicId]
                            }" [routerLink]="['/policy-configuration']">{{policyNameByTopic[schema.topicId]}}</a>
                        </td>
                        <td [pTooltip]="schema.name" class="text-truncate" style="min-width: 140px; max-width: 150px;">
                            {{ schema.name }}
                        </td>
                        <td style="min-width: 140px;">
                            <ng-container *ngIf="schema.topicId === 'draft'; else topicExplorer">
                                <span>Draft</span>
                            </ng-container>
                            <ng-template #topicExplorer>
                                <hedera-explorer [params]="schema.topicId" type="topics">{{ schema.topicId }}</hedera-explorer>
                            </ng-template>
                        </td>
                        <td style="min-width: 140px;">
                            {{ schema.version || schema.sourceVersion }}
                        </td>
                        <td style="min-width: 140px;">
                            {{ schema.entity }}
                        </td>
                        <td style="min-width: 140px;">
                            <tags-explorer 
                                [data]="schema._tags" 
                                [entity]="tagEntity" 
                                [owner]="owner" 
                                [schemas]="tagSchemas"
                                [service]="tagsService" 
                                [target]="schema.id"></tags-explorer>
                        </td>
                        <td style="min-width: 140px;">
                            <span [ngSwitch]="schema.status">
                                <div *ngSwitchCase="'DRAFT'">
                                    <span class="schema-status status-DRAFT">Draft</span>
                                </div>
                                <div *ngSwitchCase="'PUBLISHED'">
                                    <span class="schema-status status-PUBLISHED">Published</span>
                                </div>
                                <div *ngSwitchCase="'UNPUBLISHED'">
                                    <span class="schema-status status-UNPUBLISHED">Unpublished</span>
                                </div>
                                <div *ngSwitchDefault>
                                    <span class="schema-status">{{schema.status}}</span>
                                </div>
                            </span>
                        </td>
                        <td class="last-schema-grid-cell" style="min-width: 140px;">
                            <div class="operations-row-container">
                                <div>
                                    <div 
                                        (click)="onPublish(schema)" 
                                        *ngIf="schema.status == 'DRAFT'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                    <div 
                                        (click)="onPublish(schema)" 
                                        *ngIf="schema.status == 'UNPUBLISHED'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="last-schema-grid-cell" style="min-width: 140px;">
                            <div class="operations-row-container">
                                <div style="margin-left: auto;">
                                    <div 
                                        *ngIf="ifCanEdit(schema)"
                                        (click)="onEditSchema(schema)" 
                                        class="btn-settings" 
                                        matTooltip="Edit"
                                        matTooltipClass="guardian-tooltip" 
                                        matTooltipPosition="above">
                                        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                                            <path class="color-primary" clip-rule="evenodd"
                                                d="M16.5084 6.31676C16.8031 6.03714 17.1971 5.8857 17.6038 5.89575C18.0105 5.9058 18.3966 6.07652 18.677 6.37035C18.9574 6.66418 19.1093 7.05705 19.0992 7.46253C19.0892 7.86802 18.9179 8.25291 18.6232 8.53252L8.08714 18.5537L5.37201 18.9094L6.48508 15.8059L16.5075 6.31771L16.5084 6.31676ZM20.0522 5.0628C19.4242 4.40569 18.5605 4.02384 17.6505 4.00108C16.7405 3.97832 15.8586 4.3165 15.1984 4.94139L5.00859 14.586C4.90058 14.6882 4.81814 14.8143 4.7679 14.9541L3.05549 19.7318C3.00064 19.8848 2.98614 20.0494 3.01339 20.2096C3.04063 20.3698 3.10871 20.5204 3.21109 20.6468C3.31346 20.7733 3.44671 20.8714 3.59804 20.9317C3.74938 20.9921 3.91373 21.0126 4.07533 20.9915L8.64177 20.3939C8.84179 20.3679 9.02835 20.2792 9.17452 20.1406L19.9351 9.90599C20.5946 9.27903 20.9773 8.4166 20.999 7.50836C21.0208 6.60012 20.6808 5.72045 20.0522 5.0628ZM13.466 19.1029C13.2137 19.1029 12.9717 19.2029 12.7933 19.3808C12.6149 19.5586 12.5147 19.7999 12.5147 20.0515C12.5147 20.303 12.6149 20.5443 12.7933 20.7222C12.9717 20.9001 13.2137 21 13.466 21H19.1741C19.4264 21 19.6684 20.9001 19.8468 20.7222C20.0252 20.5443 20.1254 20.303 20.1254 20.0515C20.1254 19.7999 20.0252 19.5586 19.8468 19.3808C19.6684 19.2029 19.4264 19.1029 19.1741 19.1029H13.466Z"
                                                fill-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div 
                                        *ngIf="!ifCanEdit(schema)"
                                        class="btn-settings" 
                                        matTooltip="Edit"
                                        matTooltipClass="guardian-tooltip" 
                                        matTooltipPosition="above">
                                        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                                            <path class="color-grey" clip-rule="evenodd"
                                                d="M16.5084 6.31676C16.8031 6.03714 17.1971 5.8857 17.6038 5.89575C18.0105 5.9058 18.3966 6.07652 18.677 6.37035C18.9574 6.66418 19.1093 7.05705 19.0992 7.46253C19.0892 7.86802 18.9179 8.25291 18.6232 8.53252L8.08714 18.5537L5.37201 18.9094L6.48508 15.8059L16.5075 6.31771L16.5084 6.31676ZM20.0522 5.0628C19.4242 4.40569 18.5605 4.02384 17.6505 4.00108C16.7405 3.97832 15.8586 4.3165 15.1984 4.94139L5.00859 14.586C4.90058 14.6882 4.81814 14.8143 4.7679 14.9541L3.05549 19.7318C3.00064 19.8848 2.98614 20.0494 3.01339 20.2096C3.04063 20.3698 3.10871 20.5204 3.21109 20.6468C3.31346 20.7733 3.44671 20.8714 3.59804 20.9317C3.74938 20.9921 3.91373 21.0126 4.07533 20.9915L8.64177 20.3939C8.84179 20.3679 9.02835 20.2792 9.17452 20.1406L19.9351 9.90599C20.5946 9.27903 20.9773 8.4166 20.999 7.50836C21.0208 6.60012 20.6808 5.72045 20.0522 5.0628ZM13.466 19.1029C13.2137 19.1029 12.9717 19.2029 12.7933 19.3808C12.6149 19.5586 12.5147 19.7999 12.5147 20.0515C12.5147 20.303 12.6149 20.5443 12.7933 20.7222C12.9717 20.9001 13.2137 21 13.466 21H19.1741C19.4264 21 19.6684 20.9001 19.8468 20.7222C20.0252 20.5443 20.1254 20.303 20.1254 20.0515C20.1254 19.7999 20.0252 19.5586 19.8468 19.3808C19.6684 19.2029 19.4264 19.1029 19.1741 19.1029H13.466Z"
                                                fill-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                                <div>
                                    <div 
                                        class="btn-settings" 
                                        [matMenuTriggerFor]="schemaMenu"
                                        [matMenuTriggerData]="{ schema }"
                                        matTooltip="Menu"
                                        matTooltipClass="guardian-tooltip" 
                                        matTooltipPosition="above">
                                        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                                            <path class="color-primary" clip-rule="evenodd"
                                                d="m 20,12 c 0,0.6227 -0.5048,1.1275 -1.1275,1.1275 H 5.12752 C 4.50481,13.1275 4,12.6227 4,12 4,11.3773 4.50481,10.8725 5.12752,10.8725 H 18.8725 C 19.4952,10.8725 20,11.3773 20,12 Z"
                                                fill-rule="evenodd" />
                                            <path class="color-primary" clip-rule="evenodd"
                                                d="m 20,18.5005 c 0,0.6227 -0.5048,1.1275 -1.1275,1.1275 H 5.12752 C 4.50481,19.628 4,19.1232 4,18.5005 4,17.8778 4.50481,17.373 5.12752,17.373 H 18.8725 c 0.6227,0 1.1275,0.5048 1.1275,1.1275 z"
                                                fill-rule="evenodd" />
                                            <path class="color-primary" clip-rule="evenodd"
                                                d="M 20,5.5005 C 20,6.1232 19.4952,6.628 18.8725,6.628 H 5.12752 C 4.50481,6.628 4,6.1232 4,5.5005 4,4.8778 4.50481,4.373 5.12752,4.373 H 18.8725 C 19.4952,4.373 20,4.8778 20,5.5005 Z"
                                                fill-rule="evenodd" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </ng-container>
                    <ng-container *ngIf="type === 'module'">
                        <td [pTooltip]="schema.name" class="text-truncate" style="min-width: 140px; max-width: 150px;">
                            {{ schema.name }}
                        </td>
                        <td style="min-width: 140px;">
                            <span [ngSwitch]="schema.status">
                                <div *ngSwitchCase="'DRAFT'">
                                    <span class="schema-status status-DRAFT">Draft</span>
                                </div>
                                <div *ngSwitchCase="'PUBLISHED'">
                                    <span class="schema-status status-PUBLISHED">Published</span>
                                </div>
                                <div *ngSwitchCase="'UNPUBLISHED'">
                                    <span class="schema-status status-UNPUBLISHED">Unpublished</span>
                                </div>
                                <div *ngSwitchDefault>
                                    <span class="schema-status">{{schema.status}}</span>
                                </div>
                            </span>
                        </td>
                        <td class="last-schema-grid-cell" style="min-width: 140px;">
                            <div class="operations-row-container">
                                <div>
                                    <div 
                                        (click)="onPublish(schema)" 
                                        *ngIf="schema.status == 'DRAFT'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                    <div 
                                        (click)="onPublish(schema)" 
                                        *ngIf="schema.status == 'UNPUBLISHED'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                </div>
                            </div>
                        </td>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'tool'">
                        <td class="first-schema-grid-cell text-truncate" style="min-width: 140px; max-width: 150px;">
                            <a [queryParams]="{toolId: toolIdByTopic[schema.topicId]}"
                                [routerLink]="'/policy-configuration'">
                                {{ toolNameByTopic[schema.topicId] }}
                            </a>
                        </td>
                        <td [pTooltip]="schema.name" class="text-truncate" style="min-width: 140px; max-width: 150px;">
                            {{ schema.name }}
                        </td>
                        <td style="min-width: 140px;">
                            <span [ngSwitch]="schema.status">
                                <div *ngSwitchCase="'DRAFT'">
                                    <span class="schema-status status-DRAFT">Draft</span>
                                </div>
                                <div *ngSwitchCase="'PUBLISHED'">
                                    <span class="schema-status status-PUBLISHED">Published</span>
                                </div>
                                <div *ngSwitchCase="'UNPUBLISHED'">
                                    <span class="schema-status status-UNPUBLISHED">Unpublished</span>
                                </div>
                                <div *ngSwitchDefault>
                                    <span class="schema-status">{{schema.status}}</span>
                                </div>
                            </span>
                        </td>
                        <td class="last-schema-grid-cell" style="min-width: 140px;">
                            <div class="operations-row-container">
                                <div>
                                    <div 
                                        (click)="onPublish(schema)" 
                                        *ngIf="schema.status == 'DRAFT'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                    <div 
                                        (click)="onPublish(schema)" 
                                        *ngIf="schema.status == 'UNPUBLISHED'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                </div>
                            </div>
                        </td>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'system'">
                        <td [pTooltip]="schema.name" class="text-truncate" style="min-width: 140px; max-width: 150px;">
                            {{ schema.name }}
                        </td>
                        <td style="min-width: 140px;">
                            {{ schema.owner }}
                        </td>
                        <td style="min-width: 140px;">
                            {{ schema.entity }}
                        </td>
                        <td style="min-width: 140px;">
                            <span>
                                <div *ngIf="!schema.active">
                                    <span class="schema-status status-DRAFT">Inactive</span>
                                </div>
                                <div *ngIf="schema.active">
                                    <span class="schema-status status-PUBLISHED">Active</span>
                                </div>
                            </span>
                        </td>
                        <td class="last-schema-grid-cell" style="min-width: 140px;">
                            <div class="operations-row-container">
                                <div>
                                    <div (click)="onActive(schema)" *ngIf="!schema.active" class="btn-approve">
                                        Active
                                    </div>
                                </div>
                            </div>
                        </td>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>
                    <ng-container *ngIf="type === 'tag'">
                        <td [pTooltip]="schema.name" class="text-truncate" style="min-width: 140px; max-width: 150px;">
                            {{ schema.name }}
                        </td>
                        <td style="min-width: 140px;">
                            {{ schema.owner }}
                        </td>
                        <td style="min-width: 140px;">
                            <span [ngSwitch]="schema.status">
                                <div *ngSwitchCase="'DRAFT'">
                                    <span class="schema-status status-DRAFT">Draft</span>
                                </div>
                                <div *ngSwitchCase="'PUBLISHED'">
                                    <span class="schema-status status-PUBLISHED">Published</span>
                                </div>
                                <div *ngSwitchCase="'UNPUBLISHED'">
                                    <span class="schema-status status-UNPUBLISHED">Unpublished</span>
                                </div>
                                <div *ngSwitchDefault>
                                    <span class="schema-status">{{schema.status}}</span>
                                </div>
                            </span>
                        </td>
                        <td class="last-schema-grid-cell" style="min-width: 140px;">
                            <div class="operations-row-container">
                                <div>
                                    <div 
                                        (click)="onPublishTagSchema(schema)" 
                                        *ngIf="schema.status == 'DRAFT'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                    <div 
                                        (click)="onPublishTagSchema(schema)" 
                                        *ngIf="schema.status == 'UNPUBLISHED'"
                                        [attr.disabled]="schema.topicId === 'draft'" 
                                        class="btn-approve">
                                        Publish
                                    </div>
                                </div>
                            </div>
                        </td>
                        <th class="header-cell-text" style="min-width: 140px;">
                        </th>
                    </ng-container>

                </tr>
            </ng-template>
            <ng-template let-columns pTemplate="emptymessage"></ng-template>
        </p-table>
    </div>

    <app-paginator 
        *ngIf="isAny"
        [pageIndex]="pageIndex" 
        [pageSize]="pageSize" 
        [length]="count"
        (page)="onPage($event)"
    ></app-paginator>

    <div *ngIf="!isSystem && !isConfirmed" class="not-exist">
        Before starting work you need to get DID
        <a [routerLink]="['/profile']">here</a>
    </div>
</div>

<div *ngIf="loading" class="loading">
    <div class="preloader-image preloader-image-l-size"></div>
</div>

<mat-menu #schemaMenu="matMenu">
    <ng-template matMenuContent let-element="schema">
        <button *ngIf="ifCanCopy(element)" mat-menu-item (click)="onCopySchema(element)" class="schema-menu-btn">
            <mat-icon>content_copy</mat-icon>
            <span>Copy</span>
        </button>

        <button *ngIf="ifCanExport(element)" mat-menu-item (click)="onExport(element)" class="schema-menu-btn">
            <mat-icon>import_export</mat-icon>
            <span>Export</span>
        </button>

        <div *ngIf="ifCanExport(element) || ifCanCopy(element)" class="schema-menu-delimiter"></div>

        <button mat-menu-item (click)="onOpenConfig(element)" class="schema-menu-btn">
            <mat-icon>settings</mat-icon>
            <span>Configuration</span>
        </button>

        <button mat-menu-item (click)="onOpenForm(element, true)" class="schema-menu-btn">
            <mat-icon>description</mat-icon>
            <span>Example</span>
        </button>

        <button mat-menu-item (click)="onOpenForm(element, false)" class="schema-menu-btn">
            <mat-icon>visibility</mat-icon>
            <span>Preview</span>
        </button>

        <button mat-menu-item (click)="onOpenDocument(element)" class="schema-menu-btn">
            <mat-icon>segment</mat-icon>
            <span>Schema</span>
        </button>
		
        <button mat-menu-item (click)="onViewSchemaTree(element)" class="schema-menu-btn">
            <mat-icon>account_tree</mat-icon>
            <span>Tree</span>
        </button>
        
        <div class="schema-menu-delimiter"></div>

        <button *ngIf="ifCanDelete(element)" mat-menu-item (click)="onCheckDeleteSchema(element)" class="schema-menu-btn-del">
            <mat-icon>delete</mat-icon>
            <span>Delete schema</span>
        </button>
        <button *ngIf="!ifCanDelete(element)" mat-menu-item class="schema-menu-btn-des">
            <mat-icon>delete</mat-icon>
            <span>Delete schema</span>
        </button>
    </ng-template>
</mat-menu>