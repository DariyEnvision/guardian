<div class="container">
    <ng-container [ngTemplateOutlet]="header"></ng-container>
    <ng-container *ngIf="!loading">
        <ng-container [ngTemplateOutlet]="actionsContainer"></ng-container>
        <ng-container [ngTemplateOutlet]="tableContainer"></ng-container>
    </ng-container>
    <div *ngIf="loading" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>
</div>

<ng-template #header>
    <div class="header">
        <h1>Logs</h1>
    </div>
</ng-template>

<ng-template #actionsContainer>
    <div class="actions-container">
        <form [formGroup]="searchForm">
            <div class="flex flex-column-gap-8" style="flex-wrap: wrap; row-gap: 8px;">
                <p-multiSelect [formControlName]="'attributes'" [options]="attributes" [placeholder]="'Attributes'">
                    <ng-template let-item pTemplate="selectedItem">
                        <div class="country-item country-item-value">
                            <span class="grey-6">{{ item }}</span>
                        </div>
                    </ng-template>
                    <ng-template let-item pTemplate="item">
                        <div class="country-item">
                            <div>{{ item }}</div>
                        </div>
                    </ng-template>
                </p-multiSelect>
                <span class="p-input-icon-right">
                    <i>
                        <svg
                                fill="none"
                                height="16"
                                viewBox="0 0 16 16"
                                width="16"
                                xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                    clip-rule="evenodd"
                                    d="M3.19998 7.19961C3.19998 6.13874 3.6214 5.12133 4.37155 4.37118C5.12169 3.62104 6.13911 3.19961 7.19998 3.19961C8.26084 3.19961 9.27826 3.62104 10.0284 4.37118C10.7785 5.12133 11.2 6.13874 11.2 7.19961C11.2 8.26048 10.7785 9.27789 10.0284 10.028C9.27826 10.7782 8.26084 11.1996 7.19998 11.1996C6.13911 11.1996 5.12169 10.7782 4.37155 10.028C3.6214 9.27789 3.19998 8.26048 3.19998 7.19961ZM7.19998 1.59961C6.31265 1.59961 5.43802 1.81047 4.64816 2.21481C3.85831 2.61915 3.17585 3.20539 2.65702 3.92523C2.13819 4.64507 1.79784 5.4779 1.66402 6.35508C1.53021 7.23226 1.60675 8.12869 1.88735 8.97049C2.16795 9.81228 2.64457 10.5753 3.27793 11.1968C3.91129 11.8183 4.68327 12.2803 5.53024 12.5449C6.37721 12.8095 7.27492 12.869 8.14941 12.7185C9.02389 12.5681 9.85011 12.212 10.56 11.6796C10.5827 11.7099 10.6076 11.7385 10.6344 11.7652L13.0344 14.1652C13.1853 14.3109 13.3873 14.3916 13.5971 14.3897C13.8069 14.3879 14.0075 14.3038 14.1558 14.1555C14.3042 14.0071 14.3883 13.8065 14.3901 13.5967C14.3919 13.387 14.3113 13.1849 14.1656 13.034L11.7656 10.634C11.7388 10.6072 11.7102 10.5824 11.68 10.5596C12.304 9.72762 12.684 8.73831 12.7773 7.70252C12.8707 6.66674 12.6739 5.62541 12.2088 4.69521C11.7437 3.76502 11.0287 2.98272 10.1441 2.43596C9.2594 1.88921 8.23996 1.59961 7.19998 1.59961Z"
                                    fill="#B0B5BA"
                                    fill-rule="evenodd"
                            />
                        </svg>
                    </i>
                    <input
                            [formControlName]="'message'"
                            class="search-input"
                            pInputText
                            placeholder="Message"
                    />
                </span>
                <p-dropdown [formControlName]="'type'" [options]="types">
                    <ng-template let-item pTemplate="selectedItem">
                        <div class="country-item country-item-value">
                            <span class="grey-6">Message Type {{ item.label }}</span>
                        </div>
                    </ng-template>
                    <ng-template let-item pTemplate="item">
                        <div class="country-item">
                            <div>{{ item.label }}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
                <p-calendar [formControl]="dateRangeForm" [maxDate]="currentDate" [placeholder]="'Enter date range'"
                            [showIcon]="true" [showTime]="true" dateFormat="mm/dd/yy"
                            selectionMode="range"></p-calendar>
            </div>
        </form>
        <div class="flex flex-column-gap-8">
            <button
                    (click)="onApply()"
                    class="button"
                    label="Apply"
                    pButton
                    type="button"
            ></button>
            <button
                    (click)="clearValues()"
                    class="button secondary"
                    label="Clear filters"
                    pButton
                    type="button"
            ></button>
            <button
                    (click)="onSave()"
                    class="button"
                    label="Save logs"
                    pButton
                    type="button"
            ></button>
        </div>
    </div>
</ng-template>

<ng-template #tableContainer>
    <ng-container *ngIf="logs && logs.length > 0; else noData">
        <div class="table-container">
            <table>
                <tr class="row-header">
                    <th>TYPE</th>
                    <th>DATE TIME</th>
                    <th>MESSAGE</th>
                    <th>ATTRIBUTES</th>
                    <th>DETAILS</th>
                </tr>
                <ng-container *ngFor="let log of logs">
                    <tr class="row-item">
                        <td>{{ log.type }}</td>
                        <td>{{ $any(log).datetime }}</td>
                        <td>
                            {{ log.message }}
                        </td>
                        <td>
                            {{ log.attributes }}
                        </td>
                        <td>
                            <button (click)="openDetails(log)" class="button secondary" pButton>Details</button>
                        </td>
                    </tr>
                </ng-container>
            </table>

            <app-paginator 
                [pageIndex]="pageIndex" 
                [pageSize]="pageSize" 
                [length]="totalCount"
                (page)="onPage($event)"
            ></app-paginator>

        </div>
    </ng-container>
</ng-template>

<ng-template #noData>
    <div class="not-exist">
        <svg
                fill="none"
                height="32"
                viewBox="0 0 32 32"
                width="32"
                xmlns="http://www.w3.org/2000/svg"
        >
            <path
                    class="disabled-color"
                    clip-rule="evenodd"
                    d="M2.66699 8C2.66699 6.89543 3.56243 6 4.66699 6C5.77156 6 6.66699 6.89543 6.66699 8C6.66699 9.10457 5.77156 10 4.66699 10C3.56243 10 2.66699 9.10457 2.66699 8ZM9.33366 8.00082C9.3337 7.26444 9.93069 6.66752 10.6671 6.66756L28.0004 6.66852C28.7368 6.66856 29.3337 7.26555 29.3337 8.00193C29.3336 8.73831 28.7366 9.33523 28.0002 9.33519L10.6669 9.33423C9.93054 9.33419 9.33362 8.7372 9.33366 8.00082ZM2.66699 16C2.66699 14.8956 3.56236 14 4.66699 14C5.77163 14 6.66699 14.8956 6.66699 16C6.66699 17.1044 5.77163 18 4.66699 18C3.56236 18 2.66699 17.1044 2.66699 16ZM9.33366 16.0009C9.3337 15.2645 9.93069 14.6676 10.6671 14.6676L28.0004 14.6687C28.7368 14.6687 29.3337 15.2657 29.3337 16.0021C29.3336 16.7385 28.7366 17.3354 28.0002 17.3353L10.6669 17.3343C9.93053 17.3342 9.33361 16.7372 9.33366 16.0009ZM2.66699 24C2.66699 22.8956 3.56236 22 4.66699 22C5.77163 22 6.66699 22.8956 6.66699 24C6.66699 25.1044 5.77163 26 4.66699 26C3.56236 26 2.66699 25.1044 2.66699 24ZM9.33366 24.0009C9.3337 23.2645 9.93069 22.6676 10.6671 22.6676L28.0004 22.6687C28.7368 22.6687 29.3337 23.2657 29.3337 24.0021C29.3336 24.7385 28.7366 25.3354 28.0002 25.3353L10.6669 25.3343C9.93053 25.3342 9.33361 24.7372 9.33366 24.0009Z"
                    fill-rule="evenodd"
            />
        </svg>
        <span class="info-text-strong"
        >There were no Logs by current criteria</span
        >
        <span class="info-text"></span>
    </div>
</ng-template>
