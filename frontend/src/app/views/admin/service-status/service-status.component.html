<div class="container">
    <ng-container [ngTemplateOutlet]="header"></ng-container>
    <ng-container [ngTemplateOutlet]="statusContainer"></ng-container>
    <div *ngIf="false" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>
</div>

<ng-template #header>
    <div class="header">
        <h1>Services status</h1>
    </div>
</ng-template>

<ng-template #statusContainer>
    <div class="status-container">
        <ng-container *ngFor="let service of servicesStates">
            <div class="item">
                <div class="header">
                    <span>{{ service.serviceName }}</span>
                    <div class="statuses">
                        <div *ngFor="let state of service.states" [ngSwitch]="state" [pTooltip]="state">
                            <svg-icon *ngSwitchCase="'READY'"
                                src="/assets/images/icons/check.svg" 
                                svgClass="success-color">
                            </svg-icon>
                            <svg *ngSwitchCase="'BAD_CONFIGURATION'" fill="none" height="24" viewBox="0 0 24 24"
                                 width="24" xmlns="http://www.w3.org/2000/svg">
                                <path clip-rule="evenodd" d="M9.84604 0.222555C10.1105 0.372 10.3296 0.588745 10.4807 0.850274L17.775 13.4761C18.2423 14.285 17.9582 15.3155 17.1404 15.7777C16.8826 15.9234 16.591 16 16.2942 16H1.70555C0.763599 16 0 15.2447 0 14.3131C0 14.0195 0.0774579 13.731 0.224717 13.4761L7.51903 0.850274C7.98636 0.041355 9.0282 -0.239684 9.84604 0.222555ZM8.95411 10.7543C8.34499 10.7543 7.88815 11.1996 7.88815 11.7934C7.88815 12.4142 8.33114 12.8596 8.95411 12.8596C9.56323 12.8596 10.0201 12.4142 10.0201 11.8069C10.0201 11.1996 9.56323 10.7543 8.95411 10.7543ZM9.80688 4.21736H8.10134V9.27819H9.80688V4.21736Z"
                                      fill="#ffb524"
                                      fill-rule="evenodd"/>
                            </svg>
                            <div *ngSwitchCase="'INITIALIZING'" class="preloader-image"></div>
                            <div *ngSwitchCase="'STARTED'" class="preloader-image"></div>
                            <svg-icon *ngSwitchCase="'STOPPED'"
                                src="/assets/images/icons/time.svg" 
                                svgClass="error-color">
                            </svg-icon>
                        </div>
                    </div>
                </div>
                <div class="actions-container">
                    <button [queryParams]="{ attr: service.serviceName }" [routerLink]="'/admin/logs'" class="button secondary" label="View Logs"
                            pButton type="button"></button>
                </div>
            </div>
        </ng-container>
    </div>
</ng-template>

<div *ngIf="false" class="service-status-container">
    <ng-template #info let-allServicesAreRunning="getIfAllServicesAreRunning()"
                 let-loadingServices="getLoadingServices()"
                 let-stoppedServices="getStoppedServices()">
        <h1 class="info-message" *ngIf="loadingServices.length">
            {{ getServiceNames(loadingServices) }}
            is (are) initializing
            <br/>
            Please wait...
        </h1>
        <h1 class="info-message" *ngIf="stoppedServices.length">
            There are some problems with services...
        </h1>
        <h1 *ngIf="allServicesAreRunning" class="info-message">
            All services are running
        </h1>
        <table class="status-table">
            <tr *ngFor="let service of servicesStates" class="service-status-row">
                <td class="">
                    <b>{{ service.serviceName }}</b>
                </td>
                <td class="">-</td>
                <td class="flex-line">
                    <div *ngFor="let state of service.states" [ngSwitch]="state">
                        <div *ngSwitchCase="'READY'" class="icon-row">
                            <mat-icon class="icon-status ready-status">check</mat-icon>
                            <!--                            <span>(Ready)</span>-->
                        </div>
                        <div *ngSwitchCase="'BAD_CONFIGURATION'" class="icon-row">
                            <mat-icon class="icon-status bad-configuration-status">build</mat-icon>
                            <!--                            <span>(Wrong configuration, <a [routerLink]="'/admin/logs'" [queryParams]="{ attr: service.serviceName }">View-->
                            <!--                                    Logs</a>, <a [routerLink]="'/admin/settings'">Update</a>)</span>-->
                        </div>
                        <div *ngSwitchCase="'INITIALIZING'" class="icon-row">
                            <mat-spinner [diameter]="35" *ngSwitchCase="'INITIALIZING'"></mat-spinner>
                            <!--                            <span>(Initializing)</span>-->
                        </div>
                        <div *ngSwitchCase="'STARTED'" class="icon-row">
                            <mat-spinner [diameter]="35" *ngSwitchCase="'STARTED'"></mat-spinner>
                            <!--                            <span>(Started)</span>-->
                        </div>
                        <div *ngSwitchCase="'STOPPED'" class="icon-row">
                            <mat-icon *ngSwitchCase="'STOPPED'" class="icon-status stopped-status">close</mat-icon>
                            <!--                            <span>-->
                            <!--                                (Stopped, <a [routerLink]="'/admin/logs'" [queryParams]="{ attr: service.serviceName }">View-->
                            <!--                                    Logs</a>)-->
                            <!--                            </span>-->
                        </div>
                    </div>
                    <div *ngIf="!service.states.length" class="icon-row">
                        <mat-icon class="icon-status stopped-status">close</mat-icon>
                        <span>
                            (Stopped, <a [routerLink]="'/admin/logs'" [queryParams]="{ attr: service.serviceName }">View
                            Logs</a>)
                        </span>
                    </div>
                </td>
            </tr>
        </table>
        <div class="back" *ngIf="last && !stoppedServices.length && !loadingServices.length" (click)="onBack()">
            Return to previous page
        </div>
    </ng-template>
    <ng-container *ngTemplateOutlet="info; context: this"></ng-container>
</div>
