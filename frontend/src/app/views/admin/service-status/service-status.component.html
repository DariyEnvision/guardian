<div class="container">
    <ng-container [ngTemplateOutlet]="header"></ng-container>
    <ng-container [ngTemplateOutlet]="statusContainer"></ng-container>
    <div *ngIf="false" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>
</div>

<ng-template #header>
    <div class="header">
        <h1>Services status</h1>
    </div>
</ng-template>

<ng-template #statusContainer>
    <div class="status-container">
        <ng-container *ngFor="let service of servicesStates">
            <div class="item">
                <div class="header">
                    <span>{{ service.serviceName }}</span>
                    <div class="statuses">
                        <div *ngFor="let state of service.states" [ngSwitch]="state" [pTooltip]="state">
                            <svg *ngSwitchCase="'READY'" fill="none" height="24" viewBox="0 0 24 24" width="24"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path clip-rule="evenodd" d="M12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5ZM3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12ZM16.2338 8.59853C16.6397 8.97314 16.665 9.6058 16.2904 10.0116L11.3672 15.3449C11.1779 15.55 10.9115 15.6667 10.6324 15.6667C10.3533 15.6667 10.0869 15.55 9.89763 15.3449L7.70963 12.9745C7.33503 12.5687 7.36035 11.9361 7.76617 11.5615C8.172 11.1869 8.80466 11.2122 9.17926 11.618L10.6325 13.1923L14.8208 8.65505C15.1954 8.24923 15.828 8.22393 16.2338 8.59853Z"
                                      fill="#19BE47"
                                      fill-rule="evenodd"/>
                            </svg>
                            <svg *ngSwitchCase="'BAD_CONFIGURATION'" fill="none" height="24" viewBox="0 0 24 24"
                                 width="24" xmlns="http://www.w3.org/2000/svg">
                                <path clip-rule="evenodd" d="M9.84604 0.222555C10.1105 0.372 10.3296 0.588745 10.4807 0.850274L17.775 13.4761C18.2423 14.285 17.9582 15.3155 17.1404 15.7777C16.8826 15.9234 16.591 16 16.2942 16H1.70555C0.763599 16 0 15.2447 0 14.3131C0 14.0195 0.0774579 13.731 0.224717 13.4761L7.51903 0.850274C7.98636 0.041355 9.0282 -0.239684 9.84604 0.222555ZM8.95411 10.7543C8.34499 10.7543 7.88815 11.1996 7.88815 11.7934C7.88815 12.4142 8.33114 12.8596 8.95411 12.8596C9.56323 12.8596 10.0201 12.4142 10.0201 11.8069C10.0201 11.1996 9.56323 10.7543 8.95411 10.7543ZM9.80688 4.21736H8.10134V9.27819H9.80688V4.21736Z"
                                      fill="#ffb524"
                                      fill-rule="evenodd"/>
                            </svg>
                            <div *ngSwitchCase="'INITIALIZING'" class="preloader-image"></div>
                            <div *ngSwitchCase="'STARTED'" class="preloader-image"></div>
                            <svg *ngSwitchCase="'STOPPED'" height="24px" viewBox="0 0 24 24"
                                 width="24px" xmlns="http://www.w3.org/2000/svg">
                                <path d="M 12 2 C 6.4889971 2 2 6.4889971 2 12 C 2 17.511003 6.4889971 22 12 22 C 17.511003 22 22 17.511003 22 12 C 22 6.4889971 17.511003 2 12 2 z M 12 4 C 16.430123 4 20 7.5698774 20 12 C 20 16.430123 16.430123 20 12 20 C 7.5698774 20 4 16.430123 4 12 C 4 7.5698774 7.5698774 4 12 4 z M 8.7070312 7.2929688 L 7.2929688 8.7070312 L 10.585938 12 L 7.2929688 15.292969 L 8.7070312 16.707031 L 12 13.414062 L 15.292969 16.707031 L 16.707031 15.292969 L 13.414062 12 L 16.707031 8.7070312 L 15.292969 7.2929688 L 12 10.585938 L 8.7070312 7.2929688 z"
                                      fill="#FF432A"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="actions-container">
                    <button [queryParams]="{ attr: service.serviceName }" [routerLink]="'/admin/logs'" class="button secondary" label="View Logs"
                            pButton type="button"></button>
                </div>
            </div>
        </ng-container>
    </div>
</ng-template>

<div *ngIf="false" class="service-status-container">
    <ng-template #info let-allServicesAreRunning="getIfAllServicesAreRunning()"
                 let-loadingServices="getLoadingServices()"
                 let-stoppedServices="getStoppedServices()">
        <h1 class="info-message" *ngIf="loadingServices.length">
            {{ getServiceNames(loadingServices) }}
            is (are) initializing
            <br/>
            Please wait...
        </h1>
        <h1 class="info-message" *ngIf="stoppedServices.length">
            There are some problems with services...
        </h1>
        <h1 *ngIf="allServicesAreRunning" class="info-message">
            All services are running
        </h1>
        <table class="status-table">
            <tr *ngFor="let service of servicesStates" class="service-status-row">
                <td class="">
                    <b>{{ service.serviceName }}</b>
                </td>
                <td class="">-</td>
                <td class="flex-line">
                    <div *ngFor="let state of service.states" [ngSwitch]="state">
                        <div *ngSwitchCase="'READY'" class="icon-row">
                            <mat-icon class="icon-status ready-status">check</mat-icon>
                            <!--                            <span>(Ready)</span>-->
                        </div>
                        <div *ngSwitchCase="'BAD_CONFIGURATION'" class="icon-row">
                            <mat-icon class="icon-status bad-configuration-status">build</mat-icon>
                            <!--                            <span>(Wrong configuration, <a [routerLink]="'/admin/logs'" [queryParams]="{ attr: service.serviceName }">View-->
                            <!--                                    Logs</a>, <a [routerLink]="'/admin/settings'">Update</a>)</span>-->
                        </div>
                        <div *ngSwitchCase="'INITIALIZING'" class="icon-row">
                            <mat-spinner [diameter]="35" *ngSwitchCase="'INITIALIZING'"></mat-spinner>
                            <!--                            <span>(Initializing)</span>-->
                        </div>
                        <div *ngSwitchCase="'STARTED'" class="icon-row">
                            <mat-spinner [diameter]="35" *ngSwitchCase="'STARTED'"></mat-spinner>
                            <!--                            <span>(Started)</span>-->
                        </div>
                        <div *ngSwitchCase="'STOPPED'" class="icon-row">
                            <mat-icon *ngSwitchCase="'STOPPED'" class="icon-status stopped-status">close</mat-icon>
                            <!--                            <span>-->
                            <!--                                (Stopped, <a [routerLink]="'/admin/logs'" [queryParams]="{ attr: service.serviceName }">View-->
                            <!--                                    Logs</a>)-->
                            <!--                            </span>-->
                        </div>
                    </div>
                    <div *ngIf="!service.states.length" class="icon-row">
                        <mat-icon class="icon-status stopped-status">close</mat-icon>
                        <span>
                            (Stopped, <a [routerLink]="'/admin/logs'" [queryParams]="{ attr: service.serviceName }">View
                            Logs</a>)
                        </span>
                    </div>
                </td>
            </tr>
        </table>
        <div class="back" *ngIf="last && !stoppedServices.length && !loadingServices.length" (click)="onBack()">
            Return to previous page
        </div>
    </ng-template>
    <ng-container *ngTemplateOutlet="info; context: this"></ng-container>
</div>
