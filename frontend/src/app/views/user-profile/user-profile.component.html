<div class="content user-profile">
    <div *ngIf="loading && !taskId" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>

    <async-progress
            *ngIf="loading && taskId"
            [taskId]="taskId"
            (error)="onAsyncError($event)"
            (completed)="onAsyncCompleted()"
    ></async-progress>

    <ng-container *ngIf="isConfirmed; else elseTemplate">
        <div *ngIf="profile" class="profile">
            <div class="header">
                <h1>Profile</h1>
            </div>
            <div class="user-info-container">
                <div class="item">
                    <span>HEDERA ID</span>
                    <div>
                        <hedera-explorer
                                type="accounts"
                                [params]="profile.hederaAccountId || ''"
                        >{{ profile.hederaAccountId }}
                        </hedera-explorer>
                    </div>
                </div>
                <div class="item">
                    <span>BALANCE</span>
                    <span>{{ balance }}</span>
                </div>
                <div *ngIf="profile.topicId" class="item">
                    <span>USER TOPIC</span>
                    <div>
                        <hedera-explorer
                                type="topics"
                                [params]="profile.topicId"
                        >{{ profile.topicId }}
                        </hedera-explorer>
                    </div>
                </div>
                <div class="item">
                    <span>Standard Registry</span>
                    <span>{{ profile.parent }}</span>
                </div>
                <div class="item">
                    <span>DID</span>
                    <span>{{ profile.did }}</span>
                </div>
                <div class="item">
                    <span>DID Document</span>
                    <div
                            (click)="openDIDDocument(didDocument, 'DID')"
                            class="view-document-button"
                    >
                        <svg
                                width="16"
                                height="16"
                                viewBox="0 0 16 16"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M4.45616 1.3335C3.46786 1.3335 2.66669 2.14753 2.66669 3.15168V12.8486C2.66669 13.8528 3.46786 14.6668 4.45616 14.6668H12.2105C13.1989 14.6668 14 13.8528 14 12.8486V6.78804C14 6.6273 13.9372 6.47315 13.8253 6.35949L9.05338 1.51102C8.99629 1.45302 8.92883 1.40798 8.85546 1.37779C8.78502 1.34881 8.70908 1.3335 8.6316 1.3335H4.45616ZM8.03511 2.54562H4.45616C4.12672 2.54562 3.85967 2.81696 3.85967 3.15168V12.8486C3.85967 13.1834 4.12673 13.4547 4.45616 13.4547H12.2105C12.54 13.4547 12.807 13.1834 12.807 12.8486V7.3941H8.6316C8.30216 7.3941 8.03511 7.12277 8.03511 6.78804V2.54562ZM11.9635 6.182L9.22809 3.40273V6.182H11.9635Z"
                                    fill="#0681EE"
                            />
                        </svg>
                        <span>View document</span>
                    </div>
                </div>
                <div *ngIf="vcDocument" class="item">
                    <span>VC Document</span>
                    <div
                            (click)="openVCDocument(vcDocument, 'VC')"
                            class="view-document-button"
                    >
                        <svg
                                width="16"
                                height="16"
                                viewBox="0 0 16 16"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M4.45616 1.3335C3.46786 1.3335 2.66669 2.14753 2.66669 3.15168V12.8486C2.66669 13.8528 3.46786 14.6668 4.45616 14.6668H12.2105C13.1989 14.6668 14 13.8528 14 12.8486V6.78804C14 6.6273 13.9372 6.47315 13.8253 6.35949L9.05338 1.51102C8.99629 1.45302 8.92883 1.40798 8.85546 1.37779C8.78502 1.34881 8.70908 1.3335 8.6316 1.3335H4.45616ZM8.03511 2.54562H4.45616C4.12672 2.54562 3.85967 2.81696 3.85967 3.15168V12.8486C3.85967 13.1834 4.12673 13.4547 4.45616 13.4547H12.2105C12.54 13.4547 12.807 13.1834 12.807 12.8486V7.3941H8.6316C8.30216 7.3941 8.03511 7.12277 8.03511 6.78804V2.54562ZM11.9635 6.182L9.22809 3.40273V6.182H11.9635Z"
                                    fill="#0681EE"
                            />
                        </svg>
                        <span>View document</span>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
    <ng-template #elseTemplate>
        <div *ngIf="isNewAccount && !isFailed && !loading" class="finish-setup-main-container">
            <div class="user-profile-setup-title">User Profile Setup</div>

            <div class="content-main-block-container">
                <div class="progress-container">
                    <div
                            *ngFor="let step of steps"
                            class="step-item"
                            [ngClass]="{ active: step.index === currentStep }"
                    >
                        <i
                                class="pi"
                                [ngClass]="
                                step.index === currentStep
                                    ? 'pi-check'
                                    : 'pi-angle-right'
                            "
                        ></i>
                        <p>{{ step.label }}</p>
                    </div>
                </div>

                <div class="forms-container">
                    <ng-container *ngIf="currentStep === 0">
                        <div class="user-onboarding-wizard__header">
                            <form
                                    *ngIf="hasRegistries"
                                    class="user-onboarding-wizard__filters"
                                    [formGroup]="filtersForm"
                            >
                                <div class="search-inputs">
                                    <label
                                            htmlFor="policyName"
                                            class="form-label"
                                    >Filter by</label
                                    >

                                    <span class="p-input-icon-right">
                                        <input
                                                type="text"
                                                id="policyName"
                                                pInputText
                                                formControlName="policyName"
                                                placeholder="Policy name"
                                        />
                                        <i class="pi pi-search"></i>
                                    </span>

                                    <span class="p-input-icon-right">
                                        <input
                                                type="text"
                                                pInputText
                                                formControlName="geography"
                                                placeholder="Geography"
                                        />
                                        <i class="pi pi-search"></i>
                                    </span>
                                </div>

                                <div
                                        class="user-onboarding-wizard__filter-btns"
                                >
                                    <p-button
                                            label="Apply"
                                            class="apply-filters-button"
                                            [disabled]="isFilterButtonDisabled"
                                            (click)="applyFilters()"
                                    ></p-button>
                                    <p-button
                                            class="clear-filters-button"
                                            styleClass="p-button-outlined"
                                            [disabled]="!filtersForm.dirty"
                                            (click)="clearFilters()"
                                    >Clear filters
                                    </p-button
                                    >
                                </div>
                            </form>
                        </div>

                        <div class="user-onboarding-wizard__content">
                            <ng-container
                                    *ngIf="!noFilterResults; else noResults"
                            >
                                <p *ngIf="!hasRegistries" class="no-results">
                                    Standard registries have not been created
                                    yet.
                                </p>

                                <ul class="standard-registry">
                                    <app-standard-registry-card
                                            *ngFor="
                                            let registry of standardRegistriesList;
                                            trackBy: trackByDid
                                        "
                                            [registry]="registry"
                                            (registrySelected)="
                                            selectStandardRegistry($event)
                                        "
                                            [isRegistrySelected]="
                                            isRegistrySelected(registry.did)
                                        "
                                    ></app-standard-registry-card>
                                </ul>
                            </ng-container>

                            <ng-template #noResults>
                                <p *ngIf="noFilterResults" class="no-results">
                                    No results found.
                                </p>
                            </ng-template>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="currentStep === 1"
                    >
                        <div class="hedera-credentials-title">
                            Hedera Credentials
                        </div>

                        <div class="hedera-credentials-form-container">
                            <form class="hedera-form" [formGroup]="hederaForm">
                                <div *ngIf="schema" class="list-item">
                                    <app-schema-form
                                            [formGroup]="vcForm"
                                            [schema]="schema"
                                            [private-fields]="hideVC"
                                            (change)="onChangeForm()"
                                            [showButtons]="false"
                                    >
                                    </app-schema-form>
                                </div>


                                <div class="input-field-container">
                                    <label class="form-label" htmlFor="operatorId"
                                    >* OPERATOR ID (Hedera Account):</label
                                    >
                                    <input
                                            type="text"
                                            id="operatorId"
                                            placeholder="0.0.1548173"
                                            pInputText
                                            formControlName="id"
                                    />
                                </div>
                                <div class="input-field-container">
                                    <label class="form-label" htmlFor="operatorKey"
                                    >* OPERATOR KEY (Hedera Account Private Key):</label
                                    >
                                    <input
                                            type="text"
                                            id="operatorKey"
                                            placeholder="302e020100300506032b657004220420e..."
                                            pInputText
                                            formControlName="key"
                                    />
                                </div>
                                <p-button
                                        styleClass="p-button-outlined"
                                        class="generate-btn"
                                        label="Generate"
                                        (click)="randomKey()"
                                >
                                </p-button>
                            </form>
                        </div>
                    </ng-container>
                </div>
            </div>
            <div class="user-profile-setup-buttons-container">
                <div class="user-profile-next-button" *ngIf="currentStep === 0">
                    <p-button
                            label="Next"
                            [disabled]="!isStandardRegistrySelected"
                            (click)="changeStep(true)"
                    >
                    </p-button>
                </div>
                <div
                        class="user-profile-finish-buttons"
                        *ngIf="currentStep === 1"
                >
                    <div class="previous-button">
                        <p-button
                                label="Previous"
                                styleClass="p-button-outlined"
                                (click)="changeStep(false)"
                        ></p-button>
                    </div>
                    <div class="confirm-button">
                        <p-button
                                label="Submit"
                                [disabled]="hederaForm.invalid"
                                (click)="onHederaSubmit()"
                        >
                        </p-button>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="!isNewAccount && !isFailed" class="clock-list">
            <div class="clock-loader"></div>
            <p>Creating DID ...</p>
        </div>
        <div *ngIf="isFailed" class="error-list">
            <p>An error occurred while creating the document.</p>
            <p>Please try again later.</p>
            <button
                    mat-raised-button
                    type="button"
                    color="primary"
                    class="generate-btn"
                    (click)="retry()"
            >
                Retry
            </button>
        </div>
    </ng-template>
</div>
