<div class="container">
    <ng-container [ngTemplateOutlet]="header"></ng-container>
    <ng-container *ngIf="!loading && isConfirmed">
        <ng-container [ngTemplateOutlet]="actionsContainer"></ng-container>
        <ng-container [ngTemplateOutlet]="tableContainer"></ng-container>
    </ng-container>
    <ng-container *ngIf="!loading && !isConfirmed" [ngTemplateOutlet]="noDIDSettings"></ng-container>
    <div *ngIf="loading" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>
</div>

<ng-template #header>
    <div class="header">
        <h1>Artifacts</h1>
    </div>
</ng-template>

<ng-template #actionsContainer>
    <div class="actions-container">
        <div class="dropdown-block">
            <p-dropdown (ngModelChange)="onFilter()" [(ngModel)]="currentPolicy" [options]="policies!">
                <ng-template pTemplate="selectedItem">
                    <div *ngIf="currentPolicy"><span class="dropdown-label">Policy</span> <span
                            class="dropdown-item">{{ currentPolicy.name }}</span></div>
                </ng-template>
                <ng-template let-policy pTemplate="item">
                    <div
                            class="dropdown-item">{{ policy.name + (policy.id !== -1 ? ' (' + policy.id + ')' : '') }}
                    </div>
                </ng-template>
            </p-dropdown>
        </div>
        <div class="flex flex-column-gap-8">
            <button (click)="importArtifacts()" [icon]="'pi pi-download'" class="button" label="Import an Artifact" pButton
                    type="button"></button>
        </div>
    </div>
</ng-template>

<ng-template #tableContainer>
    <ng-container *ngIf="artifacts && artifacts.length > 0 else noData">
        <div class="table-container">
            <table>
                <tr class="row-header">
                    <th>ID</th>
                    <th>POLICY</th>
                    <th>NAME</th>
                    <th>EXTENTION</th>
                    <th>TYPE</th>
                    <th></th>
                </tr>
                <ng-container *ngFor="let artifact of artifacts">
                    <tr class="row-item">
                        <td>{{ artifact.uuid }}</td>
                        <td>{{ policyNameById[artifact.policyId] }}</td>
                        <td>{{ artifact.name }}</td>
                        <td>{{ artifact.extention }}</td>
                        <td>{{ artifact.type }}</td>
                        <td>
                            <div class="flex flex-sb-c">
                                <div class="flex flex-column-gap-20">
                                    <svg (click)="artifact.editable ? openDeleteArtifactDialog(artifact) : null"
                                         class="opacity-icon"
                                         fill="none" height="24"
                                         viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                                        <path [class.disabled-color]="!artifact.editable"
                                              class="accent-color-red"
                                              clip-rule="evenodd" d="M10 4C9.44771 4 9 4.44771 9 5V6H15V5C15 4.44771 14.5523 4 14 4H10ZM17 6V5C17 3.34315 15.6569 2 14 2H10C8.34315 2 7 3.34315 7 5V6H5C4.44772 6 4 6.44771 4 7C4 7.55228 4.44772 8 5 8V18C5 19.6569 6.34315 21 8 21H16C17.6569 21 19 19.6569 19 18V8C19.5523 8 20 7.55228 20 7C20 6.44771 19.5523 6 19 6H17ZM17 8H7V18C7 18.5523 7.4477 19 8 19H16C16.5523 19 17 18.5523 17 18V8ZM10 10C10.5523 10 11 10.4477 11 11V16C11 16.5523 10.5523 17 10 17C9.44772 17 9 16.5523 9 16V11C9 10.4477 9.44772 10 10 10ZM14 10C14.5523 10 15 10.4477 15 11V16C15 16.5523 14.5523 17 14 17C13.4477 17 13 16.5523 13 16V11C13 10.4477 13.4477 10 14 10Z"
                                              fill="#FF432A"
                                              fill-rule="evenodd"/>
                                    </svg>
                                </div>
                            </div>
                        </td>
                    </tr>
                </ng-container>
            </table>
            <div class="table-paginator">
                <span>Items per page:</span>
                <div style="width: 100px;">
                    <p-dropdown (onChange)="newOnPage()" [(ngModel)]="pageSize" [options]="[10,25,50,100]"></p-dropdown>
                </div>
                <span class="color-grey-6">{{ pageIndex * pageSize + 1 }}
                    â€“ {{ (pageIndex * pageSize + pageSize) > artifactsCount ? artifactsCount : (pageIndex * pageSize + pageSize) }}
                    of {{ artifactsCount }}</span>
                <div class="flex">
                    <svg (click)="movePageIndex(-1)" fill="none" height="24" viewBox="0 0 24 24" width="24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path
                                d="M15.2828 5.68906C14.8923 5.29856 14.2591 5.29856 13.8686 5.68906L8.98115 10.5813C8.20075 11.3625 8.20106 12.6283 8.98184 13.4091L13.8722 18.2994C14.2627 18.6899 14.8959 18.6899 15.2864 18.2994C15.677 17.9089 15.677 17.2757 15.2864 16.8852L11.1008 12.6996C10.7103 12.309 10.7103 11.6759 11.1008 11.2854L15.2828 7.10326C15.6733 6.71276 15.6733 6.07956 15.2828 5.68906Z"
                                fill="#848FA9"/>
                    </svg>
                    <svg (click)="movePageIndex(+1)" fill="none" height="24" viewBox="0 0 24 24" width="24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path
                                d="M8.6926 5.68907C9.0831 5.29857 9.7163 5.29857 10.1068 5.68907L14.9942 10.5813C15.7746 11.3625 15.7743 12.6283 14.9936 13.4091L10.1032 18.2994C9.7127 18.6899 9.0795 18.6899 8.689 18.2994C8.2984 17.9089 8.2984 17.2757 8.689 16.8852L12.8746 12.6996C13.2651 12.309 13.2651 11.6759 12.8746 11.2854L8.6926 7.10327C8.3021 6.71277 8.3021 6.07957 8.6926 5.68907Z"
                                fill="#848FA9"/>
                    </svg>
                </div>
            </div>
        </div>
    </ng-container>
</ng-template>

<ng-template #noData>
    <div class="not-exist">
        <svg fill="none" height="32" viewBox="0 0 32 32" width="32" xmlns="http://www.w3.org/2000/svg">
            <path class="disabled-color" clip-rule="evenodd" d="M2.66699 8C2.66699 6.89543 3.56243 6 4.66699 6C5.77156 6 6.66699 6.89543 6.66699 8C6.66699 9.10457 5.77156 10 4.66699 10C3.56243 10 2.66699 9.10457 2.66699 8ZM9.33366 8.00082C9.3337 7.26444 9.93069 6.66752 10.6671 6.66756L28.0004 6.66852C28.7368 6.66856 29.3337 7.26555 29.3337 8.00193C29.3336 8.73831 28.7366 9.33523 28.0002 9.33519L10.6669 9.33423C9.93054 9.33419 9.33362 8.7372 9.33366 8.00082ZM2.66699 16C2.66699 14.8956 3.56236 14 4.66699 14C5.77163 14 6.66699 14.8956 6.66699 16C6.66699 17.1044 5.77163 18 4.66699 18C3.56236 18 2.66699 17.1044 2.66699 16ZM9.33366 16.0009C9.3337 15.2645 9.93069 14.6676 10.6671 14.6676L28.0004 14.6687C28.7368 14.6687 29.3337 15.2657 29.3337 16.0021C29.3336 16.7385 28.7366 17.3354 28.0002 17.3353L10.6669 17.3343C9.93053 17.3342 9.33361 16.7372 9.33366 16.0009ZM2.66699 24C2.66699 22.8956 3.56236 22 4.66699 22C5.77163 22 6.66699 22.8956 6.66699 24C6.66699 25.1044 5.77163 26 4.66699 26C3.56236 26 2.66699 25.1044 2.66699 24ZM9.33366 24.0009C9.3337 23.2645 9.93069 22.6676 10.6671 22.6676L28.0004 22.6687C28.7368 22.6687 29.3337 23.2657 29.3337 24.0021C29.3336 24.7385 28.7366 25.3354 28.0002 25.3353L10.6669 25.3343C9.93053 25.3342 9.33361 24.7372 9.33366 24.0009Z"
                  fill-rule="evenodd"/>
        </svg>
        <span class="info-text-strong">No Artifacts</span>
        <span *ngIf="currentPolicy" class="info-text">in Policy with name <u>{{ currentPolicy.name }}</u></span>
    </div>
</ng-template>

<ng-template #noDIDSettings>
    <div class="not-exist">
        <span>Before starting work you need to get DID <a [routerLink]="['/profile']">here</a></span>
    </div>
</ng-template>

<div *ngIf="false" class="content">
    <div *ngIf="isConfirmed" class="actions">
        <mat-form-field appearance="outline">
            <mat-label>Policy</mat-label>
            <mat-select (selectionChange)="onFilter()" [(value)]="currentPolicy">
                <mat-option value="">All policies</mat-option>
                <mat-option *ngFor="let policy of policies" [value]="policy.id">
                    <span>{{policy.name}}</span>
                    <span> ({{policy.topicId}})</span>
                </mat-option>
            </mat-select>
        </mat-form-field>
        <div style="text-align: end">
            <button (click)="importArtifacts()" class="g-btn" color="primary" mat-raised-button>
                Import an Artifact
            </button>
        </div>
    </div>

    <div *ngIf="isConfirmed" class="table-container">
        <table mat-table [dataSource]="artifacts" class="artifacts-table">
            <ng-container matColumnDef="uuid">
                <th *matHeaderCellDef mat-header-cell> ID</th>
                <td mat-cell *matCellDef="let element">{{element.uuid}}</td>
            </ng-container>
            <ng-container matColumnDef="policy">
                <th *matHeaderCellDef mat-header-cell> Policy</th>
                <td mat-cell *matCellDef="let element">{{policyNameById[element.policyId]}}</td>
            </ng-container>
            <ng-container matColumnDef="name">
                <th *matHeaderCellDef mat-header-cell> Name</th>
                <td mat-cell *matCellDef="let element">{{element.name}}</td>
            </ng-container>
            <ng-container matColumnDef="extention">
                <th *matHeaderCellDef mat-header-cell> Extention</th>
                <td mat-cell *matCellDef="let element">{{element.extention}}</td>
            </ng-container>
            <ng-container matColumnDef="type">
                <th *matHeaderCellDef mat-header-cell> Type</th>
                <td mat-cell *matCellDef="let element">{{element.type}}</td>
            </ng-container>

            <ng-container matColumnDef="delete">
                <th *matHeaderCellDef mat-header-cell></th>
                <td mat-cell *matCellDef="let element">
                    <div *ngIf="element.editable" class="btn-settings btn-delete" (click)="deleteArtifact(element)"
                         matTooltip="Delete" matTooltipClass="guardian-tooltip" matTooltipPosition="above">
                        <mat-icon>delete</mat-icon>
                    </div>
                    <div *ngIf="!element.editable" class="btn-settings btn-delete-des">
                        <mat-icon>delete</mat-icon>
                    </div>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: columns;"></tr>
        </table>
    </div>
    <div *ngIf="isConfirmed" class="table-paginator">
        <mat-paginator [length]="artifactsCount" [pageIndex]="pageIndex" [pageSize]="pageSize"
                       (page)="onPage($event)" [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page">
        </mat-paginator>
    </div>

    <div *ngIf="!isConfirmed" class="not-exist">
        Before starting work you need to get DID <a [routerLink]="['/profile']">here</a>
    </div>

    <div *ngIf="loading" class="loading">
        <div class="preloader-image preloader-image-l-size"></div>
    </div>
</div>

<p-dialog [(visible)]="deleteArtifactVisible" [closable]="true" [draggable]="false" [modal]="true">
    <ng-template pTemplate="header">
        <span class="modal-header">Detele Artifact</span>
    </ng-template>
    <ng-template pTemplate="container">
        <div class="" style="padding: 0 10px 0 10px;">
            Are you sure to delete artifact?
        </div>
    </ng-template>
    <ng-template pTemplate="footer">
        <button (click)="deleteArtifact(false)" class="button secondary" label="Cancel" pButton
                type="button"></button>
        <button (click)="deleteArtifact(true)" [label]="'Delete'" class="button button-color-red" pButton
                type="button"></button>
    </ng-template>
</p-dialog>
