<form class="context" [formGroup]="dataForm">
    <div class="configurator-block-title">Schema Properties</div>

    <!--    <mat-form-field appearance="outline" [attr.disabled]="isNewVersion">-->
    <!--        <mat-label>* Schema Name</mat-label>-->
    <!--        <input-->
    <!--            matInput-->
    <!--            type="text"-->
    <!--            placeholder="Schema Name"-->
    <!--            formControlName="name"-->
    <!--            [tabindex]="value ? -1 : 0"-->
    <!--        />-->
    <!--    </mat-form-field>-->
    <div class="input-field-container">
        <label htmlFor="schemaName" class="form-label">* Schema Name</label>
        <input
                type="text"
                id="schemaName"
                pInputText
                formControlName="name"
                placeholder="Schema Name"
        />
    </div>

    <div class="optional-row">
        <div class="dropdown-field" *ngIf="isPolicy">
            <label class="form-label" htmlFor="policy">* Policy</label>
            <p-dropdown
                    id="policy"
                    [options]="policies"
                    formControlName="topicId"
                    optionLabel="name"
                    optionValue="topicId"
                    [showClear]="true"
                    placeholder="Policy"
                    appendTo="body"
                    (onChange)="onFilter($event)"
            ></p-dropdown>
        </div>
        <!--        <mat-form-field-->
        <!--            *ngIf="isPolicy"-->
        <!--            appearance="outline"-->
        <!--            [attr.disabled]="isEdit"-->
        <!--        >-->
        <!--            <mat-label>* Policy</mat-label>-->
        <!--            <mat-select-->
        <!--                formControlName="topicId"-->
        <!--                tabindex="-1"-->
        <!--                (selectionChange)="onFilter($event)"-->
        <!--            >-->
        <!--                <mat-option class="draft-topic-option" [value]="'draft'"-->
        <!--                    >No binding</mat-option-->
        <!--                >-->
        <!--                <mat-option-->
        <!--                    *ngFor="let policy of policies"-->
        <!--                    [value]="policy.topicId"-->
        <!--                    >{{ policy.name }}</mat-option-->
        <!--                >-->
        <!--            </mat-select>-->
        <!--        </mat-form-field>-->

        <div class="dropdown-field" *ngIf="isTool">
            <label class="form-label" htmlFor="tools">* Tool</label>
            <p-dropdown
                    id="tools"
                    [options]="tools"
                    formControlName="topicId"
                    optionLabel="name"
                    optionValue="topicId"
                    placeholder="No binding"
                    appendTo="body"
            ></p-dropdown>
        </div>

        <div class="dropdown-field" *ngIf="isSystem">
            <label class="form-label" htmlFor="forSystemEntity"
            >For (Entity)</label
            >
            <p-dropdown
                    id="forSystemEntity"
                    [options]="systemEntityOptions"
                    formControlName="entity"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Entity"
                    appendTo="body"
            ></p-dropdown>
        </div>
        <!--        <mat-form-field-->
        <!--            *ngIf="isSystem"-->
        <!--            appearance="outline"-->
        <!--            [attr.disabled]="isNewVersion"-->
        <!--        >-->
        <!--            <mat-label>For (Entity)</mat-label>-->
        <!--            <mat-select formControlName="entity" tabindex="-1">-->
        <!--                <mat-option value="STANDARD_REGISTRY"-->
        <!--                    >STANDARD REGISTRY</mat-option-->
        <!--                >-->
        <!--                <mat-option value="USER">USER</mat-option>-->
        <!--            </mat-select>-->
        <!--        </mat-form-field>-->

        <div class="dropdown-field" *ngIf="isPolicy || isModule">
            <label class="form-label" htmlFor="forPolicyModuleEntity"
            >For (Entity)</label
            >
            <p-dropdown
                    id="forPolicyModuleEntity"
                    [options]="policyModuleEntityOptions"
                    formControlName="entity"
                    optionLabel="label"
                    optionValue="value"
                    placeholder="Entity"
                    appendTo="body"
            ></p-dropdown>
        </div>
        <!--        <mat-form-field-->
        <!--            *ngIf="isPolicy || isModule"-->
        <!--            [attr.disabled]="isNewVersion"-->
        <!--            appearance="outline"-->
        <!--        >-->
        <!--            <mat-label>For (Entity)</mat-label>-->
        <!--            <mat-select formControlName="entity" tabindex="-1">-->
        <!--                <mat-option value="NONE">Default</mat-option>-->
        <!--                <mat-option value="VC">Verifiable Credential</mat-option>-->
        <!--                <mat-option value="EVC"-->
        <!--                    >Encrypted Verifiable Credential</mat-option-->
        <!--                >-->
        <!--            </mat-select>-->
        <!--        </mat-form-field>-->
    </div>

    <div class="input-field-container">
        <label htmlFor="descriptionForSchema" class="form-label"
        >Description</label
        >
        <input
                type="text"
                id="descriptionForSchema"
                pInputText
                formControlName="description"
                placeholder="Description for Schema (optional)"
        />

        <!--    <mat-form-field appearance="outline">-->
        <!--        <mat-label>Description for Schema (optional)</mat-label>-->
        <!--        <input-->
        <!--            matInput-->
        <!--            type="text"-->
        <!--            placeholder="Description for Schema (optional)"-->
        <!--            formControlName="description"-->
        <!--        />-->
        <!--    </mat-form-field>-->
    </div>

    <ng-container *ngIf="defaultFieldsMap[currentEntity]; let fields">
        <div class="configurator-block-title">System Fields</div>
        <div class="fields">
            <div class="custom-fields">
                <div *ngFor="let field of fields" class="custom-schema-field">
                    <schema-field-configuration
                            [value]="field"
                            [readonly]="true"
                            [extended]="extended"
                    >
                    </schema-field-configuration>
                </div>
            </div>
        </div>
    </ng-container>

    <div class="configurator-block-title">Fields</div>

    <div *ngIf="fields && fields.length" class="fields">
        <div class="custom-fields"
             cdkDropList
             [cdkDropListData]="fields"
             (cdkDropListDropped)="drop($event)"
        >
            <div
                    *ngFor="let field of fields"
                    class="custom-schema-field"
            >
                <!--<div class="re-order-handler" cdkDragHandle>
                    <mat-icon>drag_handle</mat-icon>
                </div>-->
                <schema-field-configuration
                        [form]="dataForm"
                        [field]="field"
                    [types]="types"
                        [private]="dataForm.value?.entity === 'EVC'"
                    [measureTypes]="measureTypes"
                        [schemaTypes]="schemaTypes"
                        [properties]="properties"
                        [extended]="extended"
                        (remove)="onRemove(field)"
                >
                </schema-field-configuration>
            </div>
        </div>
    </div>

    <div class="add-btn" (click)="onAdd($event)">
        <mat-icon>add</mat-icon>
        Add Field
    </div>

    <div class="configurator-block-title">Conditions</div>

    <ng-template [ngIf]="fields && fields.length > 0">
        <div
                *ngIf="conditions && conditions.length"
                class="conditions-container"
        >
            <div *ngFor="let condition of conditions">
                <div class="condition-item">
                    <div class="condition-if-container">
                        <div class="condition-label">IF</div>

                        <div class="if-condition-equality-container">
                            <div class="if-dropdown-field">
                                <label class="form-label">* Field</label>
                                <p-dropdown
                                        [options]="getFieldsForCondition()"
                                        [formControl]="condition.field"
                                        optionLabel="controlDescription.value"
                                        placeholder="Field"
                                        appendTo="body"
                                        (onChange)="
                                        onIfConditionFieldChange(
                                            condition,
                                            $event
                                        )
                                    "
                                ></p-dropdown>
                            </div>
                            <!--                        <mat-form-field-->
                            <!--                            appearance="outline"-->
                            <!--                            [ngClass]="{-->
                            <!--                                'choose-field': !condition.field?.value-->
                            <!--                            }"-->
                            <!--                        >-->
                            <!--                            <mat-label>* Field</mat-label>-->
                            <!--                            <mat-select-->
                            <!--                                [formControl]="condition.field"-->
                            <!--                                (valueChange)="-->
                            <!--                                    onIfConditionFieldChange(condition, $event)-->
                            <!--                                "-->
                            <!--                            >-->
                            <!--                                <mat-option-->
                            <!--                                    *ngFor="-->
                            <!--                                        let field of getFieldsForCondition()-->
                            <!--                                    "-->
                            <!--                                    [value]="field"-->
                            <!--                                >-->
                            <!--                                    {{ field.controlDescription.value }}-->
                            <!--                                </mat-option>-->
                            <!--                            </mat-select>-->
                            <!--                        </mat-form-field>-->

                            <div
                                    class="equal-label"
                                    *ngIf="condition.field?.value"
                            >=
                            </div
                            >

                            <div
                                    class="input-field-container"
                                    style="margin-bottom: unset"
                                    *ngIf="isConditionType1(condition)"
                            >
                                <label
                                        class="form-label"
                                >
                                    {{
                                        condition.field.value.controlRequired
                                            .value
                                            ? "Field value"
                                            : "Field value"
                                    }}</label
                                >
                                <input
                                        type="text"
                                        pInputText
                                        [formControl]="condition.fieldValue"
                                        placeholder="Field value"
                                />
                            </div>
                            <!--                            <mat-form-field-->
                            <!--                                appearance="outline"-->
                            <!--                                *ngIf="isConditionType1(condition)"-->
                            <!--                            >-->
                            <!--                                <mat-label>{{}}</mat-label>-->
                            <!--                                <input-->
                            <!--                                    matInput-->
                            <!--                                    placeholder="Field value"-->
                            <!--                                    [formControl]="condition.fieldValue"-->
                            <!--                                />-->
                            <!--                            </mat-form-field>-->

                            <div
                                    class="input-field-container"
                                    style="margin-bottom: unset"
                                    *ngIf="isConditionType2(condition)"
                            >
                                <label
                                        class="form-label"
                                >
                                    {{
                                        condition.field.value.controlRequired
                                            .value
                                            ? "* Field value"
                                            : "* Field value"
                                    }}</label
                                >
                                <input
                                        type="time"
                                        step="1"
                                        pInputText
                                        [formControl]="condition.fieldValue"
                                        placeholder="Field value"
                                />
                            </div>
                            <!--                            <mat-form-field-->
                            <!--                                *ngIf="isConditionType2(condition)"-->
                            <!--                                class="example-full-width required-form-field"-->
                            <!--                                appearance="outline"-->
                            <!--                            >-->
                            <!--                                <input-->
                            <!--                                    matInput-->
                            <!--                                    type="time"-->
                            <!--                                    step="1"-->
                            <!--                                    [formControl]="condition.fieldValue"-->
                            <!--                                />-->
                            <!--                            </mat-form-field>-->

                            <mat-form-field
                                    *ngIf="isConditionType3(condition)"
                                    class="example-full-width required-form-field"
                                    appearance="outline"
                            >
                                <mat-label>Choose a date & time</mat-label>
                                <input
                                        matInput
                                        [ngxMatDatetimePicker]="dateTimePicker"
                                        [formControl]="condition.fieldValue"
                                />
                                <mat-datepicker-toggle
                                        matSuffix
                                        [for]="$any(dateTimePicker)"
                                ></mat-datepicker-toggle>
                                <ngx-mat-datetime-picker
                                    #dateTimePicker
                                    [enableMeridian]="true"
                                ></ngx-mat-datetime-picker>
                            </mat-form-field>

                            <mat-form-field
                                    *ngIf="isConditionType4(condition)"
                                    class="example-full-width required-form-field"
                                    appearance="outline"
                            >
                                <mat-label>Choose a date</mat-label>
                                <input
                                        [formControl]="condition.fieldValue"
                                        matInput
                                        [matDatepicker]="dateItem"
                                />
                                <mat-datepicker-toggle
                                        matSuffix
                                        [for]="dateItem"
                                ></mat-datepicker-toggle>
                                <mat-datepicker #dateItem></mat-datepicker>
                            </mat-form-field>

                            <div *ngIf="isConditionType5(condition)">
                                <mat-radio-group
                                        [formControl]="condition.fieldValue"
                                >
                                    <mat-radio-button
                                            color="primary"
                                            class="boolean-option"
                                            [value]="true"
                                    >True
                                    </mat-radio-button>
                                    <mat-radio-button
                                            color="primary"
                                            class="boolean-option"
                                            [value]="false"
                                    >False
                                    </mat-radio-button>
                                </mat-radio-group>
                            </div>
                        </div>
                    </div>

                    <p class="condition-label">THEN</p>
                    <div
                            class="condition-container"
                            *ngIf="condition.thenControls"
                    >
                        <div
                                class="custom-fields"
                                cdkDropList
                            [cdkDropListData]="condition.thenControls"
                                (cdkDropListDropped)="drop($event)"
                                [cdkDropListAutoScrollDisabled]
                        >
                            <div
                                    *ngFor="
                                    let conditionField of condition.thenControls
                                "
                                    class="custom-schema-field"
                            >
                                <!--                                <div class="re-order-handler" cdkDragHandle>-->
                                <!--                                    <mat-icon>drag_handle</mat-icon>-->
                                <!--                                </div>-->
                                <schema-field-configuration
                                        [form]="dataForm"
                                        [field]="conditionField"
                                    [types]="types"
                                        [measureTypes]="measureTypes"
                                        [schemaTypes]="schemaTypes"
                                        [properties]="properties"
                                    [extended]="extended"
                                        (remove)="
                                        onConditionFieldRemove(
                                            condition,
                                            conditionField,
                                            'then'
                                        )
                                    "
                                >
                                </schema-field-configuration>
                            </div>
                        </div>
                    </div>
                    <div
                            class="add-btn"
                            (click)="onConditionFieldAdd(condition, 'then')"
                    >
                        <mat-icon>add</mat-icon>
                        Add THEN Field
                    </div>

                    <p class="condition-label">ELSE</p>
                    <div
                            class="condition-container"
                            *ngIf="condition.elseControls"
                    >
                        <div
                                class="custom-fields"
                                cdkDropList
                            [cdkDropListData]="condition.elseControls"
                                (cdkDropListDropped)="drop($event)"
                                [cdkDropListAutoScrollDisabled]
                        >
                            <div
                                    *ngFor="
                                    let conditionField of condition.elseControls
                                "
                                    class="custom-schema-field"
                            >
                                <!--                                <div class="re-order-handler" cdkDragHandle>-->
                                <!--                                    <mat-icon>drag_handle</mat-icon>-->
                                <!--                                </div>-->
                                <schema-field-configuration
                                        [form]="dataForm"
                                        [field]="conditionField"
                                    [types]="types"
                                        [measureTypes]="measureTypes"
                                        [schemaTypes]="schemaTypes"
                                        [properties]="properties"
                                    [extended]="extended"
                                        (remove)="
                                        onConditionFieldRemove(
                                            condition,
                                            conditionField,
                                            'else'
                                        )
                                    "
                                >
                                </schema-field-configuration>
                            </div>
                        </div>
                    </div>

                    <div
                            class="add-btn"
                            (click)="onConditionFieldAdd(condition, 'else')"
                    >
                        <mat-icon>add</mat-icon>
                        Add ELSE Field
                    </div>
                </div>

                <div class="rmv-btn" (click)="onConditionRemove(condition)">
                    <mat-icon>remove</mat-icon>
                    Remove Condition
                </div>
            </div>
        </div>

        <div class="add-btn" (click)="onConditionAdd()">
            <mat-icon>add</mat-icon>
            Add Condition
        </div>
    </ng-template>

    <ng-template [ngIf]="fields.length == 0">
        <div class="no-conditions-label">To add Conditions first you need to add field</div>
    </ng-template>
</form>
