<div class="dialog-header">
    <div *ngIf="policy" class="header-container">
        <div class="header-text">Search based on</div>
        <div class="header-item">{{policy.name}}</div>
    </div>
    <div *ngIf="!policy" class="header-container">
        <div class="header-text">Search policies</div>
    </div>
    <div class="header-icon" (click)="onClose()">
        <svg-icon
            src="/assets/images/icons/close.svg"
            svgClass="close-icon-color">
        </svg-icon>
    </div>
</div>
<div class="dialog-body">
    <div class="context">
        <div *ngIf="loading" class="loading">
            <div class="preloader-image preloader-image-l-size"></div>
        </div>

        <form [formGroup]="filtersForm" class="filters">
            <div class="filter-row">
                <p-dropdown
                    [options]="types"
                    appendTo="body"
                    class="type-dropdown"
                    formControlName="type"
                    optionLabel="name" 
                    optionValue="value"
                    placeholder="Type"
                    (onChange)="changeType()">
                    <ng-template let-filterSelectedProperty pTemplate="selectedItem">
                        <span class="dropdown-type">Type:</span>
                        <span>{{ filterSelectedProperty.name }}</span>
                    </ng-template>
                </p-dropdown>
                <span class="p-input-icon-right">
                    <input
                        class="search-policy-input"
                        formControlName="policyName"
                        pInputText
                        placeholder="Search by keyword"
                        type="text" />
                    <i class="pi pi-search search-icon"></i>
                </span>
                <button (click)="clearFilters()"
                    type="button"
                    [disabled]="!filtersForm.dirty"
                    class="button secondary"
                    label="Clear filters"
                    pButton></button>
                <button (click)="showFilters()"
                    type="button"
                    class="button"
                    [class.secondary]="showMoreFilters"
                    label="Filters"
                    pButton></button>
            </div>
            <div class="filter-group" [hidden]="!showMoreFilters">
                <div class="filter-row">
                    <div class="filter">
                        <p-dropdown
                            [options]="options"
                            appendTo="body"
                            class="type-dropdown"
                            formControlName="tokens"
                            optionLabel="name" 
                            optionValue="value"
                            placeholder="Tokens">
                            <ng-template let-filterSelectedProperty pTemplate="selectedItem">
                                <span class="dropdown-type">Minted Tokens:</span>
                                <span>{{ filterSelectedProperty.name }}</span>
                            </ng-template>
                        </p-dropdown>
                        <p-inputNumber 
                            [hidden]="!filtersForm.value.tokens"
                            class="type-number"
                            formControlName="tokensCount"
                            mode="decimal" 
                            [min]="0" ></p-inputNumber>
                    </div>
                    <div class="filter">
                        <p-dropdown
                            [options]="options"
                            appendTo="body"
                            class="type-dropdown"
                            formControlName="vcDocuments"
                            optionLabel="name" 
                            optionValue="value"
                            placeholder="VC Documents">
                            <ng-template let-filterSelectedProperty pTemplate="selectedItem">
                                <span class="dropdown-type">VC Documents:</span>
                                <span>{{ filterSelectedProperty.name }}</span>
                            </ng-template>
                        </p-dropdown>
                        <p-inputNumber 
                            [hidden]="!filtersForm.value.vcDocuments"
                            class="type-number"
                            formControlName="vcDocumentsCount"
                            mode="decimal" 
                            [min]="0" ></p-inputNumber>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter">
                        <p-dropdown
                            [options]="options"
                            appendTo="body"
                            class="type-dropdown"
                            formControlName="vpDocuments"
                            optionLabel="name" 
                            optionValue="value"
                            placeholder="VP Documents">
                            <ng-template let-filterSelectedProperty pTemplate="selectedItem">
                                <span class="dropdown-type">VP Documents:</span>
                                <span>{{ filterSelectedProperty.name }}</span>
                            </ng-template>
                        </p-dropdown>
                        <p-inputNumber 
                            [hidden]="!filtersForm.value.vpDocuments"
                            class="type-number"
                            formControlName="vpDocumentsCount"
                            mode="decimal" 
                            [min]="0" ></p-inputNumber>
                    </div>
                    <div class="filter">
                        <span class="p-input-icon-right">
                            <input
                                class="search-policy-input"
                                formControlName="owner"
                                pInputText
                                placeholder="Policy Owner"
                                type="text" />
                            <i class="pi pi-search search-icon"></i>
                        </span>
                    </div>
                </div>
                <div class="filter-row" style="justify-content: flex-end">
                    <button (click)="applyFilters()"
                        type="submit"
                        [disabled]="!filtersForm.dirty"
                        class="button"
                        label="Apply Filters"
                        pButton></button>
                </div>
            </div>
        </form>
        <div class="grid-container">
            <div class="grid-header">
                <div class="col-64">
                    <input 
                        class="prop-input" 
                        type="checkbox" 
                        [checked]="selectedAll"  
                        (change)="onSelectAll()">
                </div>
                <div class="col-250">ID</div>
                <div class="col-auto">Name</div>
                <div class="col-200">Tags</div>
                <div class="col-80 search-extra-column">VC</div>
                <div class="col-80 search-extra-column">VP</div>
                <div class="col-80 search-extra-column">Tokens</div>
                <div *ngIf="policy" class="col-80">Rate</div>
            </div>
            <div class="grid-body">
                <div *ngFor="let item of list" class="grid-row" (click)="onSelect(item)">
                    <div class="col-64">
                        <input 
                            class="prop-input" 
                            type="checkbox" 
                            [checked]="item._select" 
                            (change)="select()">
                    </div>
                    <div class="col-250">{{item.messageId || item.id}}</div>
                    <div class="col-auto">{{item.name}}</div>
                    <div class="col-200">{{item._tags}}</div>
                    <div class="col-80 search-extra-column">{{item.vcCount}}</div>
                    <div class="col-80 search-extra-column">{{item.vpCount}}</div>
                    <div class="col-80 search-extra-column">{{item.tokensCount}}</div>
                    <div *ngIf="policy" class="col-80 {{item._color}} color-field">{{item.rate}}%</div>
                </div>
            </div>
        </div>


    </div>
</div>
<div class="dialog-footer">
    <div class="action-buttons">
        <div class="cancel-button">
            <button (click)="onClose()" class="button secondary" label="Cancel" pButton></button>
        </div>
        <div>
            <button (click)="onCompare()" class="button" label="Compare ({{count}})" pButton></button>
        </div>
    </div>
</div>



<!-- <div class="g-dialog-content">
    <div class="g-dialog-header">
        <div class="g-dialog-title">
            {{header}}
        </div>
        <div mat-dialog-actions>
            <div class="g-dialog-title-btn open-in-new" (click)="onNewPage()">
                <mat-icon>open_in_new</mat-icon>
            </div>
            <div class="g-dialog-title-btn" (click)="onOk()">
                <mat-icon>close</mat-icon>
            </div>
        </div>
    </div>
    <div class="g-dialog-body">
        <div class="search-toolbar">
            <div class="policy-filters">
                <mat-form-field class="policy-filters__control" appearance="outline">
                    <input matInput placeholder="Search" (change)="onSearch($event)">
                </mat-form-field>
            </div>
            <div class="policy-actions">
                <div class="compare-btn" [attr.disable]="count<2" (click)="onCompare()">
                    <mat-icon>compare</mat-icon>
                    <span>Compare ({{count}})</span>
                </div>
            </div>
        </div>
        <div class="search-header">
            <div>
                <input class="prop-input" type="checkbox" [checked]="selectedAll"  (change)="onSelectAll()">
            </div>
            <div class="policy-id-field">ID</div>
            <div>Name</div>
            <div>Tags</div>
            <div class="search-extra-column">VC</div>
            <div class="search-extra-column">VP</div>
            <div class="search-extra-column">Tokens</div>
            <div>Rate</div>
        </div>
        <div *ngIf="policy" class="search-result disabled-result">
            <div>
                <input class="prop-input" type="checkbox" checked="true" disabled="true">
            </div>
            <div class="policy-id-field">{{policy.messageId || policy.id}}</div>
            <div>{{policy.name}}</div>
            <div>{{policy._tags}}</div>
            <div class="search-extra-column">{{policy.vcCount}}</div>
            <div class="search-extra-column">{{policy.vpCount}}</div>
            <div class="search-extra-column">{{policy.tokensCount}}</div>
            <div></div>
        </div>
        <div *ngFor="let item of _list" class="search-result" (click)="select(item)">
            <div>
                <input class="prop-input" type="checkbox" [checked]="item._select" (change)="onSelect()">
            </div>
            <div class="policy-id-field">{{item.messageId || item.id}}</div>
            <div>{{item.name}}</div>
            <div>{{item._tags}}</div>
            <div class="search-extra-column">{{item.vcCount}}</div>
            <div class="search-extra-column">{{item.vpCount}}</div>
            <div class="search-extra-column">{{item.tokensCount}}</div>
            <div class="{{item._color}} color-field">
                {{item.rate}}%
            </div>
        </div>
    </div>
</div> -->