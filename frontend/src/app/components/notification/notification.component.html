<div>
    <div (click)="onMenuOpened($event)" 
        (menuClosed)="menuOpened = false"
        *ngIf="!menuCollapsed && unreadNotifications > 0" 
        [matMenuTriggerFor]="notificationMenu" 
        class="badge"
    >
        <span class="notification-counter">
            {{ unreadNotifications }}
        </span>
    </div>
    <div (click)="onMenuOpened($event)" 
        *ngIf="menuCollapsed && unreadNotifications > 0" 
        class="badge"
    >
        <span class="notification-counter">
            {{ unreadNotifications }}
        </span>
    </div>

    <mat-menu #notificationMenu="matMenu" class="notification-menu-panel" xPosition="after" yPosition="below">
        <div class="notification-menu">
            <div class="notification-menu-header">
                <b class="notification-menu-header__title">Notifications</b>
                <button (click)="readAll($event)" [disabled]="!progressNotifications?.length && !notifications.length"
                    class="link-btn">Mark all as read
                </button>
            </div>
            <div (scroll)="onScrollNotifications($event)" *ngIf="progressNotifications?.length"
                class="notification-list">
                <div *ngFor="let notification of progressNotifications" [attr.unread]="true" class="notification">
                    <div [routerLink]="'/task/' + notification.taskId"
                        style="display: flex; flex-direction: column; max-width: calc(100% - 32px);">
                        <div class="notification__title">
                            <div [ngSwitch]="notification.type" class="width-min-content">
                                <svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">
                                    <path class="primary-color"
                                        d="M 12 2 C 6.4889971 2 2 6.4889971 2 12 C 2 17.511003 6.4889971 22 12 22 C 17.511003 22 22 17.511003 22 12 C 22 6.4889971 17.511003 2 12 2 z M 12 4 C 16.430123 4 20 7.5698774 20 12 C 20 16.430123 16.430123 20 12 20 C 7.5698774 20 4 16.430123 4 12 C 4 7.5698774 7.5698774 4 12 4 z M 11 6 L 11 12.414062 L 15.292969 16.707031 L 16.707031 15.292969 L 13 11.585938 L 13 6 L 11 6 z" />
                                </svg>
                            </div>
                            <span>{{ notification.action }}</span>
                        </div>
                        <div [pTooltip]="notification.message" [tooltipPosition]="'top'" class="notification__message">
                            {{ notification.message }}
                        </div>
                        <div class="notification__progressbar">
                            <div class="progress-container">
                                <p-progressBar [showValue]="false" [value]="notification.progress"></p-progressBar>
                            </div>
                            <div class="progress-value">
                                {{ notification.progress }}
                            </div>
                        </div>
                    </div>
                    <div *ngIf="notification.action" class="notification__details">
                        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M8.69236 5.68907C9.08286 5.29857 9.71606 5.29857 10.1066 5.68907L14.994 10.5813C15.7744 11.3625 15.7741 12.6283 14.9933 13.4091L10.103 18.2994C9.71246 18.6899 9.07926 18.6899 8.68876 18.2994C8.29816 17.9089 8.29816 17.2757 8.68876 16.8852L12.8744 12.6996C13.2649 12.309 13.2649 11.6759 12.8744 11.2854L8.69236 7.10327C8.30186 6.71277 8.30186 6.07957 8.69236 5.68907Z"
                                fill="#C4D0E1" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="notification-menu__delimiter" *ngIf="progressNotifications.length && notifications.length">
            </div>
            <div class="notification-list" *ngIf="notifications.length" (scroll)="onScrollNotifications($event)">
                <div (click)="viewDetails($event, notification)" *ngFor="let notification of notifications"
                    [attr.notificationId]="notification.id" [attr.type]="notification.type"
                    [attr.unread]="!notification.read" class="notification">
                    <div style="display: flex; flex-direction: column; max-width: calc(100% - 32px);">
                        <div class="notification__title">
                            <div [ngSwitch]="notification.type" class="width-min-content">
                                <svg *ngSwitchCase="'INFO'" fill="none" height="24" viewBox="0 0 24 24" width="24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M 12 2 C 6.4889971 2 2 6.4889971 2 12 C 2 17.511003 6.4889971 22 12 22 C 17.511003 22 22 17.511003 22 12 C 22 6.4889971 17.511003 2 12 2 z M 12 4 C 16.430123 4 20 7.5698774 20 12 C 20 16.430123 16.430123 20 12 20 C 7.5698774 20 4 16.430123 4 12 C 4 7.5698774 7.5698774 4 12 4 z M 11 7 L 11 9 L 13 9 L 13 7 L 11 7 z M 11 11 L 11 17 L 13 17 L 13 11 L 11 11 z"
                                        fill="#CDDDFD" />
                                </svg>
                                <svg *ngSwitchCase="'SUCCESS'" fill="none" height="24" viewBox="0 0 24 24" width="24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path clip-rule="evenodd"
                                        d="M12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5ZM3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12ZM16.2338 8.59853C16.6397 8.97314 16.665 9.6058 16.2904 10.0116L11.3672 15.3449C11.1779 15.55 10.9115 15.6667 10.6324 15.6667C10.3533 15.6667 10.0869 15.55 9.89763 15.3449L7.70963 12.9745C7.33503 12.5687 7.36035 11.9361 7.76617 11.5615C8.172 11.1869 8.80466 11.2122 9.17926 11.618L10.6325 13.1923L14.8208 8.65505C15.1954 8.24923 15.828 8.22393 16.2338 8.59853Z"
                                        fill="#19BE47" fill-rule="evenodd" />
                                </svg>
                                <svg *ngSwitchCase="'ERROR'" fill="none" height="24" viewBox="0 0 24 24" width="24"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path clip-rule="evenodd"
                                        d="M5.29289 5.29289C5.68342 4.90237 6.31658 4.90237 6.70711 5.29289L12 10.5858L17.2929 5.29289C17.6834 4.90237 18.3166 4.90237 18.7071 5.29289C19.0976 5.68342 19.0976 6.31658 18.7071 6.70711L13.4142 12L18.7071 17.2929C19.0976 17.6835 19.0976 18.3166 18.7071 18.7072C18.3166 19.0977 17.6834 19.0977 17.2929 18.7072L12 13.4142L6.70711 18.7072C6.31658 19.0977 5.68342 19.0977 5.29289 18.7072C4.90237 18.3166 4.90237 17.6835 5.29289 17.2929L10.5858 12L5.29289 6.70711C4.90237 6.31658 4.90237 5.68342 5.29289 5.29289Z"
                                        fill="#FF432A" fill-rule="evenodd" />
                                </svg>
                            </div>
                            <span>{{ notification.title }}</span>
                        </div>
                        <div [pTooltip]="notification.message" [tooltipPosition]="'top'" class="notification__message">
                            {{ notification.message }}
                        </div>
                    </div>
                    <div *ngIf="notification.action" class="notification__details">
                        <svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M8.69236 5.68907C9.08286 5.29857 9.71606 5.29857 10.1066 5.68907L14.994 10.5813C15.7744 11.3625 15.7741 12.6283 14.9933 13.4091L10.103 18.2994C9.71246 18.6899 9.07926 18.6899 8.68876 18.2994C8.29816 17.9089 8.29816 17.2757 8.68876 16.8852L12.8744 12.6996C13.2649 12.309 13.2649 11.6759 12.8744 11.2854L8.69236 7.10327C8.30186 6.71277 8.30186 6.07957 8.69236 5.68907Z"
                                fill="#C4D0E1" />
                        </svg>
                    </div>
                </div>
            </div>
            <div *ngIf="!progressNotifications.length && !notifications.length" class="no-new-notifications">
                <svg fill="none" height="32" viewBox="0 0 33 32" width="33" xmlns="http://www.w3.org/2000/svg">
                    <path clip-rule="evenodd"
                        d="M6.75613 12.4953C6.65095 7.30931 10.8272 2.6665 16.4998 2.6665C22.1739 2.6665 26.3487 7.30931 26.2421 12.4953C26.2375 12.7278 26.235 12.9603 26.2347 13.1928C26.2347 15.5044 26.5132 18.7226 26.7013 20.6314C26.7102 20.7255 26.7147 20.8195 26.7147 20.9121H28.3517C28.7446 20.9121 29.1214 21.06 29.3993 21.3232C29.6771 21.5864 29.8332 21.9434 29.8332 22.3156C29.8332 22.6879 29.6771 23.0448 29.3993 23.3081C29.1214 23.5713 28.7446 23.7191 28.3517 23.7191H22.4258C22.4258 25.2081 21.8014 26.636 20.6901 27.6889C19.5788 28.7417 18.0715 29.3332 16.4998 29.3332C14.9282 29.3332 13.4209 28.7417 12.3096 27.6889C11.1982 26.636 10.5739 25.2081 10.5739 23.7191H4.64799C4.25507 23.7191 3.87825 23.5713 3.60042 23.3081C3.32259 23.0448 3.1665 22.6879 3.1665 22.3156C3.1665 21.9434 3.32259 21.5864 3.60042 21.3232C3.87825 21.06 4.25507 20.9121 4.64799 20.9121H6.28502C6.28502 20.8195 6.28947 20.7255 6.29984 20.6314C6.4865 18.7226 6.76502 15.5044 6.76502 13.1928C6.76502 12.9683 6.76206 12.7367 6.75613 12.4953ZM12.0895 20.9121H23.7413L23.7458 20.9079C23.7477 20.9058 23.7492 20.9035 23.7502 20.9009V20.8925C23.5635 18.9837 23.2717 15.649 23.2717 13.1928C23.2717 12.9486 23.2747 12.6974 23.2806 12.4405C23.3591 8.63563 20.3191 5.47352 16.4998 5.47352C12.6806 5.47352 9.64058 8.63563 9.7191 12.4405C9.72502 12.6974 9.72799 12.9486 9.72799 13.1928C9.72799 15.649 9.43613 18.9837 9.24799 20.8925C9.24779 20.8943 9.24779 20.8962 9.24799 20.8981V20.9009L9.25391 20.9079C9.25514 20.9095 9.25664 20.911 9.25836 20.9121H12.0895ZM13.5369 23.7191C13.5369 24.4636 13.849 25.1776 14.4047 25.704C14.9604 26.2304 15.714 26.5262 16.4998 26.5262C17.2857 26.5262 18.0393 26.2304 18.595 25.704C19.1506 25.1776 19.4628 24.4636 19.4628 23.7191H13.5369Z"
                        fill="#848FA9" fill-rule="evenodd" />
                </svg>
                <span>No new notifications</span>
            </div>
            <div (click)="viewAllNotifications();"
                [class.primary-btn]="progressNotifications.length || notifications.length"
                class="notification-menu__view-all link-btn">
                View all notifications
            </div>
        </div>
    </mat-menu>
</div>